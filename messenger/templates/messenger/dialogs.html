{% extends 'home/base.html' %}

{% load messenger_extras %}
{% load tz %}
{% load i18n %}

{% block title %}{% trans "Диалоги." %}{% endblock %}

{% block content %}

    <div class="row justify-content-center">
        <div class="col-lg">
            {% if chats.count == 0 %}
            <h3>{% trans "Нет ни одного начатого диалога." %}</h3>
            {% endif %}
            {% for chat in chats %}
                {% if chat.message_set.count != 0 %}
                    {% with last_message=chat.message_set.last %}
                        {% get_companion user chat as companion %}
                        <a class="list-group-item {% if companion == last_message.author and not last_message.is_readed %}unreaded{% endif %}" href="{{ chat.get_absolute_url }}">
                            <img class="avatar-messages" src="{{ companion.userprofile.get_avatar }}">
                            <div class="reply-body">
                                <ul class="list-inline">
                                    <li class="drop-left-padding">
                                        <strong class="list-group-item-heading">{{ companion.username }}</strong>
                                    </li>
                                    <li class="pull-right text-muted"><small>{{ last_message.pub_date|utc }}</small></li>
                                </ul>
                                {% if companion != last_message.author %}
                                    <div>
                                        <img class="avatar-rounded-sm" src="{{ last_message.author.userprofile.get_avatar }}">
                                        <div class="attached-reply-body {% if not last_message.is_read %}unread{% endif %}">{{ last_message.message|truncatechars_html:"200"|safe|striptags }}</div>
                                    </div>
                                {% else %}
                                    <div>{{ last_message.message|truncatechars_html:"200"|safe|striptags }}</div>
                                {% endif %}
                            </div>
                        </a>
                    {% endwith %}
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg">
            {% if chats.count == 0 %}
            <h3>{% trans "Нет ни одного начатого диалога." %}</h3>
            {% endif %}
            {% for chat in chats %}
                {% if chat.message_set.count != 0 %}
                    {% with last_message=chat.message_set.last %}
                        {% get_companion user chat as companion %}
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">#</th>
                                    <th scope="col">{% trans "Тема" %}</th>
                                    <th scope="col">{% trans "Пользователь" %}</th>
                                    <th scope="col">{% trans "Дата" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th scope="row">1</th>
                                    <td>Theme</td>
                                    <td>{{ companion.username }}</td>
                                    <td>@mdo</td>
                                </tr>
                                </tbody>
                        </table>
                        <a class="list-group-item {% if companion == last_message.author and not last_message.is_readed %}unreaded{% endif %}" href="{{ chat.get_absolute_url }}">
                            <div class="reply-body">
                                <ul class="list-inline">
                                    <li class="drop-left-padding">
                                        <strong class="list-group-item-heading">{{ companion.username }}</strong>
                                    </li>
                                    <li class="pull-right text-muted"><small>{{ last_message.pub_date|utc }}</small></li>
                                </ul>
                            </div>
                        </a>
                    {% endwith %}
                {% endif %}
            {% endfor %}
        </div>
    </div>

{% endblock %}